!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react/jsx-runtime"),require("react")):"function"==typeof define&&define.amd?define(["exports","react/jsx-runtime","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Kairos={},t.jsxRuntime,t.React)}(this,function(t,e,n){"use strict";class r{constructor(){this.provider="MERCADOPAGO",this.mp=null,this.bricksBuilder=null,this.cardPaymentBrick=null,this.publicKey=""}async loadScript(){if(!window.MercadoPago)return new Promise((t,e)=>{const n=document.createElement("script");n.src="https://sdk.mercadopago.com/js/v2",n.async=!0,n.onload=()=>t(),n.onerror=()=>e(new Error("Failed to load MercadoPago SDK")),document.head.appendChild(n)})}async init(t,e){this.publicKey=t,await this.loadScript(),this.mp=new window.MercadoPago(t,{locale:e?.locale||"pt-BR"}),this.bricksBuilder=this.mp.bricks()}async createCardPayment(t,e){const n="string"==typeof t?t.replace("#",""):t.id;this.cardPaymentBrick&&await this.cardPaymentBrick.unmount();const r={initialization:{amount:e.amount,payer:{email:""}},customization:{visual:{style:{customVariables:{formBackgroundColor:e.styles?.primaryColor||"#ffffff",baseColor:e.styles?.primaryColor||"#1a1a1a"}}},paymentMethods:{maxInstallments:e.maxInstallments||12}},callbacks:{onReady:()=>{e.onReady?.()},onSubmit:async t=>{const n={token:t.token,installments:t.installments,paymentMethodId:t.payment_method_id,issuerId:t.issuer_id,lastFourDigits:t.last_four_digits||"",cardholderName:t.cardholder?.name||"",provider:this.provider};await e.onSubmit(n)},onError:t=>{e.onError?.({code:t.type||"UNKNOWN",message:t.message||"An error occurred",cause:t})}}};return this.cardPaymentBrick=await this.bricksBuilder.create("cardPayment",n,r),{updateAmount:t=>{console.warn("MercadoPago Bricks does not support dynamic amount update")},submit:async()=>{throw new Error("Use form submission instead")},unmount:()=>{this.cardPaymentBrick?.unmount(),this.cardPaymentBrick=null}}}async getInstallments(t,e){const n=await this.mp.getInstallments({amount:String(t),bin:e});if(!n||0===n.length)return[];return(n[0].payer_costs||[]).map((t,e)=>({installments:t.installments,installmentAmount:t.installment_amount,totalAmount:t.total_amount,interestFree:0===t.installment_rate,interestRate:t.installment_rate,recommended:0===e}))}destroy(){this.cardPaymentBrick&&(this.cardPaymentBrick.unmount(),this.cardPaymentBrick=null),this.mp=null,this.bricksBuilder=null}}class a{constructor(){this.provider="PAGSEGURO",this.publicKey="",this.environment="sandbox"}async loadScript(){if(window.PagSeguro)return;const t="production"===this.environment?"https://assets.pagseguro.com.br/checkout-sdk-js/rc/dist/browser/pagseguro.min.js":"https://stc.sandbox.pagseguro.uol.com.br/pagseguro/api/v2/checkout/pagseguro.directpayment.js";return new Promise((e,n)=>{const r=document.createElement("script");r.src=t,r.async=!0,r.onload=()=>e(),r.onerror=()=>n(new Error("Failed to load PagSeguro SDK")),document.head.appendChild(r)})}async init(t,e){this.publicKey=t,this.environment=e?.environment||"sandbox",await this.loadScript()}async createCardPayment(t,e){const n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`Container not found: ${t}`);const r=this.createFormHtml(e);n.innerHTML=r;const a=n.querySelector("form");return a.addEventListener("submit",async t=>{t.preventDefault();try{const t=new FormData(a),n={token:await this.tokenizeCard(t),installments:parseInt(t.get("installments"))||1,paymentMethodId:"credit_card",issuerId:"",lastFourDigits:t.get("cardNumber")?.slice(-4)||"",cardholderName:t.get("cardholderName")||"",provider:this.provider};await e.onSubmit(n)}catch(t){e.onError?.({code:"TOKENIZATION_ERROR",message:t.message||"Failed to tokenize card",cause:t})}}),e.onReady?.(),{updateAmount:t=>{const e=a.querySelector("[data-amount]");e&&(e.textContent=`R$ ${t.toFixed(2)}`)},submit:async()=>(a.dispatchEvent(new Event("submit")),{}),unmount:()=>{n.innerHTML=""}}}createFormHtml(t){return`\n      <form class="kairos-card-form" data-kairos-form>\n        <div class="kairos-field">\n          <label for="cardNumber">Numero do Cartao</label>\n          <input type="text" id="cardNumber" name="cardNumber"\n                 placeholder="0000 0000 0000 0000"\n                 maxlength="19" required />\n        </div>\n\n        <div class="kairos-field-row">\n          <div class="kairos-field">\n            <label for="expiry">Validade</label>\n            <input type="text" id="expiry" name="expiry"\n                   placeholder="MM/AA" maxlength="5" required />\n          </div>\n          <div class="kairos-field">\n            <label for="cvv">CVV</label>\n            <input type="text" id="cvv" name="cvv"\n                   placeholder="123" maxlength="4" required />\n          </div>\n        </div>\n\n        <div class="kairos-field">\n          <label for="cardholderName">Nome no Cartao</label>\n          <input type="text" id="cardholderName" name="cardholderName"\n                 placeholder="NOME COMO NO CARTAO" required />\n        </div>\n\n        ${!1!==t.showInstallments?`\n        <div class="kairos-field">\n          <label for="installments">Parcelas</label>\n          <select id="installments" name="installments">\n            <option value="1">1x de R$ ${t.amount.toFixed(2)}</option>\n          </select>\n        </div>\n        `:""}\n\n        <button type="submit" class="kairos-submit-btn">\n          Pagar <span data-amount>R$ ${t.amount.toFixed(2)}</span>\n        </button>\n      </form>\n    `}async tokenizeCard(t){const e=t.get("cardNumber")?.replace(/\s/g,""),[n,r]=t.get("expiry")?.split("/")||[],a=t.get("cvv"),i=t.get("cardholderName"),o=await fetch("https://api.pagseguro.com/public-keys/card",{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.publicKey},body:JSON.stringify({card:{number:e,exp_month:n,exp_year:`20${r}`,security_code:a,holder:{name:i}}})});if(!o.ok)throw new Error("Failed to tokenize card with PagSeguro");return(await o.json()).encrypted}async getInstallments(t,e){const n=[];for(let e=1;e<=12;e++){const r=e<=3,a=r?0:.0199,i=r?t:t*Math.pow(1+a,e),o=i/e;o>=5&&n.push({installments:e,installmentAmount:Math.round(100*o)/100,totalAmount:Math.round(100*i)/100,interestFree:r,interestRate:r?0:100*a,recommended:1===e})}return n}destroy(){}}class i{constructor(t){this.options=[],this.adapter=null,this.cardInstance=null,this.config={tenantId:t.tenantId,environment:t.environment||"production",apiUrl:t.apiUrl||"https://api.kairoshub.tech",preferredProvider:t.preferredProvider||void 0,locale:t.locale||"pt-BR",debug:t.debug||!1}}static async init(t){const e=new i(t);return await e.fetchOptions(),e}async fetchOptions(){const t=`${this.config.apiUrl}/api/v1/tokenization/${this.config.tenantId}/options`;this.log("Fetching tokenization options from",t);const e=await fetch(t);if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.message||`Failed to fetch tokenization options: ${e.status}`)}const n=await e.json();this.options=n.options,this.log("Available PSPs:",this.options.map(t=>t.provider))}async getAdapter(){if(this.adapter)return this.adapter;let t=this.options[0];if(this.config.preferredProvider){const e=this.options.find(t=>t.provider===this.config.preferredProvider);e&&(t=e)}if(!t)throw new Error("No PSP available for card payments. Contact your administrator.");switch(this.log("Using PSP:",t.provider),t.provider){case"MERCADOPAGO":this.adapter=new r;break;case"PAGSEGURO":this.adapter=new a;break;default:throw new Error(`Unsupported PSP provider: ${t.provider}`)}return await this.adapter.init(t.publicKey,{locale:this.config.locale,environment:t.environment}),this.adapter}async createCardPayment(t,e){const n=await this.getAdapter();return this.log("Creating card payment form with amount:",e.amount),this.cardInstance=await n.createCardPayment(t,e),this.cardInstance}async getInstallments(t,e){return(await this.getAdapter()).getInstallments(t,e)}getAvailableProviders(){return[...this.options]}getConfig(){return{...this.config}}destroy(){this.cardInstance&&(this.cardInstance.unmount(),this.cardInstance=null),this.adapter&&(this.adapter.destroy(),this.adapter=null),this.options=[]}log(...t){this.config.debug&&console.log("[Kairos]",...t)}}t.CardPaymentForm=function({tenantId:t,amount:r,environment:a="production",apiUrl:o,preferredProvider:s,maxInstallments:c=12,onSuccess:d,onError:l,onReady:m,className:u,debug:p=!1}){const h=n.useRef(null),y=n.useRef(null),[f,g]=n.useState(!0),[b,v]=n.useState(null);return n.useEffect(()=>{let e=!0;return async function(){if(h.current)try{g(!0),v(null);const n={tenantId:t,environment:a,apiUrl:o,preferredProvider:s,debug:p},u=await i.init(n);if(!e)return void u.destroy();y.current=u;const f={amount:r,maxInstallments:c,onReady:()=>{g(!1),m?.()},onSubmit:async t=>{d(t)},onError:t=>{v(t.message),l?.(t)}};await u.createCardPayment(h.current,f)}catch(t){if(e){const e=t.message||"Failed to initialize payment form";v(e),g(!1),l?.({code:"INIT_ERROR",message:e,cause:t})}}}(),()=>{e=!1,y.current&&(y.current.destroy(),y.current=null)}},[t,r,a,o,s]),e.jsxs("div",{className:u,children:[f&&e.jsxs("div",{className:"kairos-loading",children:[e.jsx("div",{className:"kairos-spinner"}),e.jsx("span",{children:"Carregando formulario de pagamento..."})]}),b&&e.jsx("div",{className:"kairos-error",children:e.jsx("span",{children:b})}),e.jsx("div",{ref:h,id:"kairos-card-payment-container",style:{display:f?"none":"block"}})]})},t.KairosPayments=i,t.VERSION="0.1.0"});
//# sourceMappingURL=kairos.min.js.map
