!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react/jsx-runtime"),require("react")):"function"==typeof define&&define.amd?define(["exports","react/jsx-runtime","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Kairos={},e.jsxRuntime,e.React)}(this,function(e,t,n){"use strict";class r{constructor(){this.provider="MERCADOPAGO",this.mp=null,this.bricksBuilder=null,this.cardPaymentBrick=null,this.publicKey=""}async loadScript(){if(!window.MercadoPago)return new Promise((e,t)=>{const n=document.createElement("script");n.src="https://sdk.mercadopago.com/js/v2",n.async=!0,n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load MercadoPago SDK")),document.head.appendChild(n)})}async init(e,t){this.publicKey=e,await this.loadScript(),this.mp=new window.MercadoPago(e,{locale:t?.locale||"pt-BR"}),this.bricksBuilder=this.mp.bricks()}async createCardPayment(e,t){const n="string"==typeof e?e.replace("#",""):e.id;this.cardPaymentBrick&&await this.cardPaymentBrick.unmount();const r={initialization:{amount:t.amount,payer:{email:""}},customization:{visual:{style:{customVariables:{formBackgroundColor:t.styles?.primaryColor||"#ffffff",baseColor:t.styles?.primaryColor||"#1a1a1a"}}},paymentMethods:{maxInstallments:t.maxInstallments||12}},callbacks:{onReady:()=>{t.onReady?.()},onSubmit:async e=>{const n={token:e.token,installments:e.installments,paymentMethodId:e.payment_method_id,issuerId:e.issuer_id,lastFourDigits:e.last_four_digits||"",cardholderName:e.cardholder?.name||"",provider:this.provider};await t.onSubmit(n)},onError:e=>{t.onError?.({code:e.type||"UNKNOWN",message:e.message||"An error occurred",cause:e})}}};return this.cardPaymentBrick=await this.bricksBuilder.create("cardPayment",n,r),{updateAmount:e=>{console.warn("MercadoPago Bricks does not support dynamic amount update")},submit:async()=>{throw new Error("Use form submission instead")},unmount:()=>{this.cardPaymentBrick?.unmount(),this.cardPaymentBrick=null}}}async getInstallments(e,t){const n=await this.mp.getInstallments({amount:String(e),bin:t});if(!n||0===n.length)return[];return(n[0].payer_costs||[]).map((e,t)=>({installments:e.installments,installmentAmount:e.installment_amount,totalAmount:e.total_amount,interestFree:0===e.installment_rate,interestRate:e.installment_rate,recommended:0===t}))}destroy(){this.cardPaymentBrick&&(this.cardPaymentBrick.unmount(),this.cardPaymentBrick=null),this.mp=null,this.bricksBuilder=null}}class a{constructor(){this.provider="PAGSEGURO",this.publicKey="",this.environment="sandbox"}async loadScript(){if(window.PagSeguro)return;const e="production"===this.environment?"https://assets.pagseguro.com.br/checkout-sdk-js/rc/dist/browser/pagseguro.min.js":"https://stc.sandbox.pagseguro.uol.com.br/pagseguro/api/v2/checkout/pagseguro.directpayment.js";return new Promise((t,n)=>{const r=document.createElement("script");r.src=e,r.async=!0,r.onload=()=>t(),r.onerror=()=>n(new Error("Failed to load PagSeguro SDK")),document.head.appendChild(r)})}async init(e,t){this.publicKey=e,this.environment=t?.environment||"sandbox",await this.loadScript()}async createCardPayment(e,t){const n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`Container not found: ${e}`);const r=this.createFormHtml(t);n.innerHTML=r;const a=n.querySelector("form");return a.addEventListener("submit",async e=>{e.preventDefault();try{const e=new FormData(a),n={token:await this.tokenizeCard(e),installments:parseInt(e.get("installments"))||1,paymentMethodId:"credit_card",issuerId:"",lastFourDigits:e.get("cardNumber")?.slice(-4)||"",cardholderName:e.get("cardholderName")||"",provider:this.provider};await t.onSubmit(n)}catch(e){t.onError?.({code:"TOKENIZATION_ERROR",message:e.message||"Failed to tokenize card",cause:e})}}),t.onReady?.(),{updateAmount:e=>{const t=a.querySelector("[data-amount]");t&&(t.textContent=`R$ ${e.toFixed(2)}`)},submit:async()=>(a.dispatchEvent(new Event("submit")),{}),unmount:()=>{n.innerHTML=""}}}createFormHtml(e){return`\n      <form class="kairos-card-form" data-kairos-form>\n        <div class="kairos-field">\n          <label for="cardNumber">Numero do Cartao</label>\n          <input type="text" id="cardNumber" name="cardNumber"\n                 placeholder="0000 0000 0000 0000"\n                 maxlength="19" required />\n        </div>\n\n        <div class="kairos-field-row">\n          <div class="kairos-field">\n            <label for="expiry">Validade</label>\n            <input type="text" id="expiry" name="expiry"\n                   placeholder="MM/AA" maxlength="5" required />\n          </div>\n          <div class="kairos-field">\n            <label for="cvv">CVV</label>\n            <input type="text" id="cvv" name="cvv"\n                   placeholder="123" maxlength="3" required />\n          </div>\n        </div>\n\n        <div class="kairos-field">\n          <label for="cardholderName">Nome no Cartao</label>\n          <input type="text" id="cardholderName" name="cardholderName"\n                 placeholder="NOME COMO NO CARTAO" required />\n        </div>\n\n        ${!1!==e.showInstallments?`\n        <div class="kairos-field">\n          <label for="installments">Parcelas</label>\n          <select id="installments" name="installments">\n            <option value="1">1x de R$ ${e.amount.toFixed(2)}</option>\n          </select>\n        </div>\n        `:""}\n\n        <button type="submit" class="kairos-submit-btn">\n          Pagar <span data-amount>R$ ${e.amount.toFixed(2)}</span>\n        </button>\n      </form>\n    `}async tokenizeCard(e){const t=e.get("cardNumber")?.replace(/\s/g,""),[n,r]=e.get("expiry")?.split("/")||[],a=e.get("cvv"),i=e.get("cardholderName"),o=await fetch("https://api.pagseguro.com/public-keys/card",{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.publicKey},body:JSON.stringify({card:{number:t,exp_month:n,exp_year:`20${r}`,security_code:a,holder:{name:i}}})});if(!o.ok)throw new Error("Failed to tokenize card with PagSeguro");return(await o.json()).encrypted}async getInstallments(e,t){const n=[];for(let t=1;t<=12;t++){const r=t<=3,a=r?0:.0199,i=r?e:e*Math.pow(1+a,t),o=i/t;o>=5&&n.push({installments:t,installmentAmount:Math.round(100*o)/100,totalAmount:Math.round(100*i)/100,interestFree:r,interestRate:r?0:100*a,recommended:1===t})}return n}destroy(){}}const i=new Map;async function o(e,t,n){const r=n||"__default__",a=Date.now(),o=i.get(r);if(o&&a-o.timestamp<864e5)return o.key;const s=n?`?merchantId=${n}`:"",c=await fetch(`${e}/api/v1/tokenization/${t}/encryption-key${s}`);if(!c.ok)throw new Error(`Failed to fetch encryption key: ${c.status}`);const l=(await c.json()).publicKey,d=atob(l),u=new Uint8Array(d.length);for(let e=0;e<d.length;e++)u[e]=d.charCodeAt(e);const p=await crypto.subtle.importKey("spki",u.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!1,["wrapKey"]);return i.set(r,{key:p,timestamp:a}),p}async function s(e,t,n,r){const a=await o(t,n,r),i=JSON.stringify({n:e.number,h:e.holderName,m:e.expirationMonth,y:e.expirationYear,c:e.cvv}),s=(new TextEncoder).encode(i),l=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),d=crypto.getRandomValues(new Uint8Array(12)),u=await crypto.subtle.encrypt({name:"AES-GCM",iv:d,tagLength:128},l,s),p=await crypto.subtle.wrapKey("raw",l,a,{name:"RSA-OAEP"}),m=JSON.stringify({ek:c(p),iv:c(d.buffer),d:c(u)});return btoa(m)}function c(e){const t=new Uint8Array(e);let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return btoa(n)}class l{constructor(){this.provider="KAIROS",this.apiUrl="",this.tenantId="",this.merchantId=""}async init(e,t){this.apiUrl=t?.apiUrl||"https://api.kairoshub.tech",this.tenantId=t?.tenantId||"",this.merchantId=t?.merchantId||""}async createCardPayment(e,t){const n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`Container not found: ${e}`);n.innerHTML=this.buildFormHtml(t);const r=n.querySelector("[data-kairos-enc-form]"),a=n.querySelector("[data-kairos-enc-error]"),i=n.querySelector("[data-kairos-enc-submit]"),o=n.querySelector("[data-kairos-enc-card-number]"),c=n.querySelector("[data-kairos-enc-expiry]"),l=n.querySelector("[data-kairos-enc-cvv]"),u=n.querySelector("[data-kairos-enc-name]"),p=n.querySelector("[data-kairos-enc-installments]"),m=n.querySelector("[data-kairos-enc-brand]");if(o.addEventListener("input",()=>{const e=o.value.replace(/\D/g,"").slice(0,16);o.value=e.replace(/(\d{4})(?=\d)/g,"$1 ");const t=d(e);m&&(m.textContent=t?t.toUpperCase():"",m.style.display=t?"block":"none")}),c.addEventListener("input",()=>{const e=c.value.replace(/\D/g,"").slice(0,4);e.length>=3?c.value=`${e.slice(0,2)}/${e.slice(2)}`:c.value=e}),l.addEventListener("input",()=>{l.value=l.value.replace(/\D/g,"").slice(0,3)}),u.addEventListener("input",()=>{u.value=u.value.toUpperCase()}),p){const e=(await this.getInstallments(t.amount,"")).filter(e=>e.installments<=(t.maxInstallments||12));p.innerHTML=e.map(e=>{const t=e.installmentAmount.toFixed(2).replace(".",","),n=e.interestFree?" sem juros":` (Total: R$ ${e.totalAmount.toFixed(2).replace(".",",")})`;return`<option value="${e.installments}">${e.installments}x de R$ ${t}${n}</option>`}).join("")}return r.addEventListener("submit",async e=>{if(e.preventDefault(),i.disabled)return;const n=this.validate(o.value,c.value,l.value,u.value);if(n)return a.textContent=n,a.style.display="block",void t.onError?.({code:"VALIDATION_ERROR",message:n});a.style.display="none",i.disabled=!0;const r=i.innerHTML;i.innerHTML=this.getLoadingButtonHtml();try{const e=o.value.replace(/\D/g,""),[n,r]=c.value.split("/"),a=(2e3+parseInt(r||"0",10)).toString(),i={token:"",encryptedData:await s({number:e,holderName:u.value.trim(),expirationMonth:n,expirationYear:a,cvv:l.value},this.apiUrl,this.tenantId,this.merchantId),installments:p?parseInt(p.value):1,paymentMethodId:d(e)||"unknown",issuerId:"",lastFourDigits:e.slice(-4),cardholderName:u.value.trim(),provider:this.provider};await t.onSubmit(i)}catch(e){a.textContent=e.message||"Erro ao processar pagamento",a.style.display="block",t.onError?.({code:"ENCRYPTION_ERROR",message:e.message||"Failed to encrypt card data",cause:e})}finally{i.disabled=!1,i.innerHTML=r}}),t.onReady?.(),{updateAmount:e=>{const t=n.querySelector("[data-kairos-enc-amount]");t&&(t.textContent=`R$ ${e.toFixed(2).replace(".",",")}`)},submit:async()=>(r.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0})),{}),unmount:()=>{n.innerHTML=""}}}async getInstallments(e,t){const n=[];for(let t=1;t<=12;t++){const r=t<=3,a=r?0:.0199,i=r?e:e*Math.pow(1+a,t),o=i/t;o>=5&&n.push({installments:t,installmentAmount:Math.round(100*o)/100,totalAmount:Math.round(100*i)/100,interestFree:r,interestRate:r?0:100*a,recommended:1===t})}return n}destroy(){}validate(e,t,n,r){if(e.replace(/\D/g,"").length<13)return"Numero do cartao invalido";if(t.length<5)return"Data de validade invalida";const[a,i]=t.split("/"),o=parseInt(a,10);if(o<1||o>12)return"Mes invalido";const s=2e3+parseInt(i||"0",10),c=new Date;return s<c.getFullYear()||s===c.getFullYear()&&o<c.getMonth()+1?"Cartao expirado":3!==n.length?"CVV invalido":r.trim().length<3?"Nome invalido":null}getLoadingButtonHtml(){return'\n      <svg class="kairos-enc-spinner" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">\n          <animate attributeName="stroke-dashoffset" values="32;0;32" dur="1.2s" repeatCount="indefinite"/>\n          <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="0.8s" repeatCount="indefinite"/>\n        </circle>\n      </svg>\n      <span>Criptografando...</span>\n    '}buildFormHtml(e){const t=e.amount.toFixed(2).replace(".",",");return`\n      <style>\n        /*\n         * Kairos Payments SDK â€” Card Form Styles\n         *\n         * Override with CSS custom properties on the parent element:\n         *   --kairos-font:        Font family (default: inherit)\n         *   --kairos-text:        Text color (default: inherit)\n         *   --kairos-text-muted:  Muted text / labels (default: inherit with opacity)\n         *   --kairos-bg:          Input background (default: transparent)\n         *   --kairos-border:      Border color (default: currentColor with opacity)\n         *   --kairos-radius:      Border radius (default: 8px)\n         *   --kairos-focus:       Focus ring color (default: #7c3aed)\n         *   --kairos-accent:      Button gradient start (default: #7c3aed)\n         *   --kairos-accent-end:  Button gradient end (default: #9333ea)\n         *   --kairos-success:     Security badge color (default: #059669)\n         */\n        .kairos-enc-form {\n          font-family: var(--kairos-font, inherit);\n          color: var(--kairos-text, inherit);\n          display: flex;\n          flex-direction: column;\n          gap: 16px;\n        }\n        .kairos-enc-field {\n          display: flex;\n          flex-direction: column;\n          gap: 6px;\n        }\n        .kairos-enc-field label {\n          font-size: 13px;\n          font-weight: 500;\n          opacity: 0.7;\n        }\n        .kairos-enc-field input,\n        .kairos-enc-field select {\n          height: 44px;\n          padding: 0 12px;\n          border: 1px solid var(--kairos-border, color-mix(in srgb, currentColor 25%, transparent));\n          border-radius: var(--kairos-radius, 8px);\n          font-size: 15px;\n          font-family: inherit;\n          color: inherit;\n          background: var(--kairos-bg, transparent);\n          outline: none;\n          transition: border-color 0.15s, box-shadow 0.15s;\n          -webkit-appearance: none;\n        }\n        .kairos-enc-field input:focus,\n        .kairos-enc-field select:focus {\n          border-color: var(--kairos-focus, #7c3aed);\n          box-shadow: 0 0 0 3px color-mix(in srgb, var(--kairos-focus, #7c3aed) 15%, transparent);\n        }\n        .kairos-enc-field input::placeholder {\n          color: inherit;\n          opacity: 0.4;\n        }\n        .kairos-enc-row {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 12px;\n        }\n        .kairos-enc-card-number-wrapper {\n          position: relative;\n        }\n        .kairos-enc-brand {\n          position: absolute;\n          right: 12px;\n          top: 50%;\n          transform: translateY(-50%);\n          font-size: 11px;\n          font-weight: 700;\n          opacity: 0.5;\n          letter-spacing: 0.05em;\n          display: none;\n        }\n        .kairos-enc-error {\n          display: none;\n          padding: 10px 14px;\n          background: color-mix(in srgb, #ef4444 10%, transparent);\n          border: 1px solid color-mix(in srgb, #ef4444 25%, transparent);\n          border-radius: var(--kairos-radius, 8px);\n          color: #ef4444;\n          font-size: 13px;\n        }\n        .kairos-enc-security {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          padding: 12px 14px;\n          background: color-mix(in srgb, var(--kairos-success, #059669) 8%, transparent);\n          border: 1px solid color-mix(in srgb, var(--kairos-success, #059669) 20%, transparent);\n          border-radius: var(--kairos-radius, 8px);\n        }\n        .kairos-enc-security-icon {\n          flex-shrink: 0;\n          width: 28px;\n          height: 28px;\n          color: var(--kairos-success, #059669);\n        }\n        .kairos-enc-security-text {\n          flex: 1;\n          min-width: 0;\n        }\n        .kairos-enc-security-text strong {\n          display: block;\n          font-size: 13px;\n          font-weight: 600;\n          color: var(--kairos-success, #059669);\n        }\n        .kairos-enc-security-text span {\n          font-size: 11px;\n          color: var(--kairos-success, #059669);\n          opacity: 0.75;\n        }\n        .kairos-enc-security-badge {\n          display: flex;\n          align-items: center;\n          gap: 5px;\n          flex-shrink: 0;\n          color: var(--kairos-success, #059669);\n          opacity: 0.85;\n        }\n        .kairos-enc-security-badge svg {\n          width: 18px;\n          height: 18px;\n        }\n        .kairos-enc-security-lock {\n          width: 10px;\n          height: 10px;\n          opacity: 0.7;\n        }\n        .kairos-enc-submit {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n          width: 100%;\n          height: 52px;\n          border: none;\n          border-radius: var(--kairos-radius, 8px);\n          font-size: 16px;\n          font-weight: 600;\n          font-family: inherit;\n          color: #fff;\n          background: linear-gradient(135deg, var(--kairos-accent, #7c3aed) 0%, var(--kairos-accent-end, #9333ea) 100%);\n          cursor: pointer;\n          transition: opacity 0.15s, transform 0.1s;\n        }\n        .kairos-enc-submit:hover:not(:disabled) {\n          opacity: 0.92;\n        }\n        .kairos-enc-submit:active:not(:disabled) {\n          transform: scale(0.98);\n        }\n        .kairos-enc-submit:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n        .kairos-enc-submit svg {\n          width: 20px;\n          height: 20px;\n        }\n        .kairos-enc-spinner {\n          animation: kairos-enc-spin 0.8s linear infinite;\n        }\n        @keyframes kairos-enc-spin {\n          to { transform: rotate(360deg); }\n        }\n      </style>\n\n      <form class="kairos-enc-form" data-kairos-enc-form>\n        <div data-kairos-enc-error class="kairos-enc-error"></div>\n\n        <div class="kairos-enc-field">\n          <label>Numero do Cartao</label>\n          <div class="kairos-enc-card-number-wrapper">\n            <input\n              type="text"\n              inputmode="numeric"\n              placeholder="0000 0000 0000 0000"\n              maxlength="19"\n              autocomplete="cc-number"\n              data-kairos-enc-card-number\n            />\n            <span class="kairos-enc-brand" data-kairos-enc-brand></span>\n          </div>\n        </div>\n\n        <div class="kairos-enc-row">\n          <div class="kairos-enc-field">\n            <label>Validade</label>\n            <input\n              type="text"\n              inputmode="numeric"\n              placeholder="MM/AA"\n              maxlength="5"\n              autocomplete="cc-exp"\n              data-kairos-enc-expiry\n            />\n          </div>\n          <div class="kairos-enc-field">\n            <label>CVV</label>\n            <input\n              type="text"\n              inputmode="numeric"\n              placeholder="123"\n              maxlength="3"\n              autocomplete="cc-csc"\n              data-kairos-enc-cvv\n            />\n          </div>\n        </div>\n\n        <div class="kairos-enc-field">\n          <label>Nome no Cartao</label>\n          <input\n            type="text"\n            placeholder="NOME COMO NO CARTAO"\n            autocomplete="cc-name"\n            data-kairos-enc-name\n          />\n        </div>\n\n        ${!1!==e.showInstallments?`\n        <div class="kairos-enc-field">\n          <label>Parcelas</label>\n          <select data-kairos-enc-installments>\n            <option value="1">1x de R$ ${t} sem juros</option>\n          </select>\n        </div>\n        `:""}\n\n        <div class="kairos-enc-security">\n          <svg class="kairos-enc-security-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>\n            <path d="m9 12 2 2 4-4"/>\n          </svg>\n          <div class="kairos-enc-security-text">\n            <strong>Pagamento Seguro</strong>\n            <span>Criptografia ponta a ponta via Kairos Payment Hub</span>\n          </div>\n          <div class="kairos-enc-security-badge">\n            <svg class="kairos-enc-security-lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>\n              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>\n            </svg>\n            <svg width="18" height="18" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        <linearGradient id="kairos-logo-grad" x1="0%" y1="0%" x2="100%" y2="100%">\n          <stop offset="0%" style="stop-color:#3B82F6"/>\n          <stop offset="100%" style="stop-color:#8B5CF6"/>\n        </linearGradient>\n      </defs>\n      <circle cx="24" cy="24" r="22" fill="url(#kairos-logo-grad)"/>\n      <path d="M16 12 L16 36 M16 24 L32 12 M16 24 L32 36" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>\n      <circle cx="36" cy="36" r="5" fill="#10B981"/>\n    </svg>\n          </div>\n        </div>\n\n        <button type="submit" class="kairos-enc-submit" data-kairos-enc-submit>\n          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>\n            <line x1="1" y1="10" x2="23" y2="10"/>\n          </svg>\n          <span>Pagar <span data-kairos-enc-amount>R$ ${t}</span></span>\n        </button>\n      </form>\n    `}}function d(e){const t=e.replace(/\D/g,"");return/^4/.test(t)?"visa":/^5[1-5]/.test(t)?"mastercard":/^3[47]/.test(t)?"amex":/^(636368|438935|504175|451416|636297)/.test(t)||/^(5067|4576|4011)/.test(t)?"elo":/^606282/.test(t)?"hipercard":""}class u{constructor(e){this.options=[],this.adapter=null,this.cardInstance=null,this.config={tenantId:e.tenantId,merchantId:e.merchantId||"",environment:e.environment||"production",apiUrl:e.apiUrl||"https://api.kairoshub.tech",preferredProvider:e.preferredProvider||void 0,locale:e.locale||"pt-BR",debug:e.debug||!1}}static async init(e){const t=new u(e);return await t.fetchOptions(),t}async fetchOptions(){const e=`${this.config.apiUrl}/api/v1/tokenization/${this.config.tenantId}/options`;this.log("Fetching tokenization options from",e);try{const t=await fetch(e);if(!t.ok)return this.log("Failed to fetch tokenization options:",t.status),void(this.options=[]);const n=await t.json();this.options=n.options||[],this.log("Available PSPs:",this.options.map(e=>e.provider))}catch(e){this.log("Error fetching tokenization options, will use Kairos encryption:",e),this.options=[]}}async getAdapter(){if(this.adapter)return this.adapter;if("KAIROS"===this.config.preferredProvider)return this.log("Using Kairos Encrypted adapter (preferred)"),this.initKairosAdapter();let e=this.options[0];if(this.config.preferredProvider){const t=this.options.find(e=>e.provider===this.config.preferredProvider);t&&(e=t)}if(!e)return this.log("No PSP with client-side tokenization available, falling back to Kairos encryption"),this.initKairosAdapter();switch(this.log("Using PSP:",e.provider),e.provider){case"MERCADOPAGO":this.adapter=new r;break;case"PAGSEGURO":this.adapter=new a;break;default:return this.log(`Unknown PSP provider "${e.provider}", falling back to Kairos encryption`),this.initKairosAdapter()}return await this.adapter.init(e.publicKey,{locale:this.config.locale,environment:e.environment}),this.adapter}async initKairosAdapter(){return this.adapter=new l,await this.adapter.init("",{apiUrl:this.config.apiUrl,tenantId:this.config.tenantId,merchantId:this.config.merchantId,locale:this.config.locale}),this.adapter}async createCardPayment(e,t){const n=await this.getAdapter();return this.log("Creating card payment form with amount:",t.amount),this.cardInstance=await n.createCardPayment(e,t),this.cardInstance}async getInstallments(e,t){return(await this.getAdapter()).getInstallments(e,t)}getAvailableProviders(){return[...this.options]}getConfig(){return{...this.config}}destroy(){this.cardInstance&&(this.cardInstance.unmount(),this.cardInstance=null),this.adapter&&(this.adapter.destroy(),this.adapter=null),this.options=[]}log(...e){this.config.debug&&console.log("[Kairos]",...e)}}const p={display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"8px 0 4px",opacity:.6},m={fontSize:"11px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',color:"#6b7280",letterSpacing:"0.02em"};function h(){return t.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"kairos-form-grad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),t.jsx("stop",{offset:"100%",stopColor:"#8B5CF6"})]})}),t.jsx("circle",{cx:"24",cy:"24",r:"22",fill:"url(#kairos-form-grad)"}),t.jsx("path",{d:"M16 12 L16 36 M16 24 L32 12 M16 24 L32 36",stroke:"white",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("circle",{cx:"36",cy:"36",r:"5",fill:"#10B981"})]})}const f=new Set(["CONFIRMED","FAILED","CANCELLED","EXPIRED","REFUNDED","CHARGEBACK"]);e.CardPaymentForm=function({tenantId:e,amount:r,environment:a="production",apiUrl:i,preferredProvider:o,maxInstallments:s=12,onSuccess:c,onError:l,onReady:d,className:f,debug:g=!1}){const y=n.useRef(null),k=n.useRef(null),[v,b]=n.useState(!0),[x,w]=n.useState(null);return n.useEffect(()=>{let t=!0;return async function(){if(y.current)try{b(!0),w(null);const n={tenantId:e,environment:a,apiUrl:i,preferredProvider:o,debug:g},p=await u.init(n);if(!t)return void p.destroy();k.current=p;const m={amount:r,maxInstallments:s,onReady:()=>{b(!1),d?.()},onSubmit:async e=>{c(e)},onError:e=>{w(e.message),l?.(e)}};await p.createCardPayment(y.current,m)}catch(e){if(t){const t=e.message||"Failed to initialize payment form";w(t),b(!1),l?.({code:"INIT_ERROR",message:t,cause:e})}}}(),()=>{t=!1,k.current&&(k.current.destroy(),k.current=null)}},[e,r,a,i,o]),t.jsxs("div",{className:f,children:[v&&t.jsxs("div",{className:"kairos-loading",children:[t.jsx("div",{className:"kairos-spinner"}),t.jsx("span",{children:"Carregando formulario de pagamento..."})]}),x&&t.jsx("div",{className:"kairos-error",children:t.jsx("span",{children:x})}),t.jsx("div",{ref:y,id:"kairos-card-payment-container",style:{display:v?"none":"block"}}),!v&&!x&&t.jsxs("div",{className:"kairos-branding",style:p,children:[t.jsx(h,{}),t.jsx("span",{style:m,children:"Powered by Kairos"})]})]})},e.KairosEncryptedAdapter=l,e.KairosPayments=u,e.PaymentPoller=class{constructor(e){this.timer=null,this.timeoutTimer=null,this.lastStatus=null,this.running=!1,this.config={fetchStatus:e.fetchStatus,onStatusChange:e.onStatusChange||(()=>{}),onComplete:e.onComplete||(()=>{}),onError:e.onError||(()=>{}),intervalMs:e.intervalMs??3e3,timeoutMs:e.timeoutMs??3e5}}start(){this.running||(this.running=!0,this.lastStatus=null,this.poll(),this.timer=setInterval(()=>this.poll(),this.config.intervalMs),this.timeoutTimer=setTimeout(()=>{this.stop(),this.config.onStatusChange("EXPIRED",{status:"EXPIRED",reason:"polling_timeout"}),this.config.onComplete("EXPIRED",{status:"EXPIRED",reason:"polling_timeout"})},this.config.timeoutMs))}stop(){this.running=!1,this.timer&&(clearInterval(this.timer),this.timer=null),this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}get isRunning(){return this.running}async poll(){if(this.running)try{const e=await this.config.fetchStatus(),t=e.status?.toUpperCase()||"PENDING";t!==this.lastStatus&&(this.lastStatus=t,this.config.onStatusChange(t,e)),f.has(t)&&(this.stop(),this.config.onComplete(t,e))}catch(e){this.config.onError(e)}}},e.VERSION="0.2.0",e.clearEncryptionCache=function(e){e?i.delete(e):i.clear()},e.encryptCardData=s,e.isEncryptionAvailable=async function(e,t,n){try{return await o(e,t,n),!0}catch{return!1}}});
//# sourceMappingURL=kairos.min.js.map
